<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RoutinePro XP</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-pop { animation: pop 0.2s ease-out forwards; }
        .level-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, onSnapshot, query, orderBy, limit, serverTimestamp, increment, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // ==========================================
        // ðŸ”´ IMPORTANT: PASTE YOUR KEYS HERE
        // ==========================================
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "NUMBERS",
            appId: "NUMBERS"
        };
        // ==========================================

        // Initialize Firebase safely
        let app, auth, db;
        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            } else {
                console.warn("Firebase keys missing. App will run in Offline/Demo mode.");
            }
        } catch (e) { console.error("Firebase Init Error:", e); }

        const { useState, useEffect, useMemo } = React;

        // --- CONSTANTS ---
        const APP_ID = "routine-xp-v2";
        const XP_PER_HOUR = 10;
        
        const THEMES = {
            indigo: { id: 'indigo', label: "Classic Indigo", price: 0, color: "indigo", bg: "bg-slate-50", btn: "bg-indigo-600", accent: "text-indigo-600" },
            emerald: { id: 'emerald', label: "Forest Focus", price: 500, color: "emerald", bg: "bg-emerald-50", btn: "bg-emerald-600", accent: "text-emerald-600" },
            rose: { id: 'rose', label: "Sunset Vibes", price: 1000, color: "rose", bg: "bg-rose-50", btn: "bg-rose-600", accent: "text-rose-600" },
            sky: { id: 'sky', label: "Deep Ocean", price: 2000, color: "sky", bg: "bg-sky-50", btn: "bg-sky-600", accent: "text-sky-600" },
            violet: { id: 'violet', label: "Royal Suite", price: 5000, color: "violet", bg: "bg-violet-50", btn: "bg-violet-600", accent: "text-violet-600" },
        };

        const DEFAULT_ROUTINE = [
            { time: "06:00", label: "Wake Up" }, { time: "07:00", label: "Coaching" },
            { time: "11:00", label: "Self Study 1" }, { time: "14:30", label: "Nap / Rest" },
            { time: "16:00", label: "Self Study 2" }, { time: "18:30", label: "Evening Study" },
            { time: "23:00", label: "Sleep" }
        ];

        const SUBJECTS = ["Physics", "Chemistry", "Math", "Biology", "English"];

        // --- COMPONENTS ---

        const Icon = ({ name, size = 16, className = "" }) => {
            const map = {
                Calendar: "fa-calendar", Clock: "fa-clock", BookOpen: "fa-book-open",
                Star: "fa-star", Edit3: "fa-pen-to-square", Layout: "fa-layer-group",
                List: "fa-list-check", CheckCircle2: "fa-circle-check", X: "fa-xmark",
                Award: "fa-medal", BarChart3: "fa-chart-simple", TrendingUp: "fa-arrow-trend-up",
                ShoppingBag: "fa-bag-shopping", Coins: "fa-coins", Check: "fa-check",
                Download: "fa-download", ChevronRight: "fa-chevron-right", Save: "fa-floppy-disk",
                Trophy: "fa-trophy", History: "fa-clock-rotate-left", Loader2: "fa-spinner fa-spin",
                Lock: "fa-lock", Unlock: "fa-unlock", Fire: "fa-fire"
            };
            return <i className={`fa-solid ${map[name] || 'fa-circle'} ${className}`} style={{fontSize: size}}></i>;
        };

        const ProgressBar = ({ current, max, color = "bg-yellow-400" }) => {
            const pct = Math.min(100, Math.max(0, (current / max) * 100));
            return (
                <div className="h-2 w-full bg-black/20 rounded-full overflow-hidden">
                    <div className={`h-full ${color} transition-all duration-500`} style={{ width: `${pct}%` }}></div>
                </div>
            );
        };

        const GamificationCard = ({ stats, todayXP }) => {
            const totalXP = (stats.totalXP || 0) + todayXP;
            // Level calc: Level 1 = 0-100, Level 2 = 101-300, etc. (Simple linear for now: 100 * level)
            const level = Math.floor(totalXP / 200) + 1;
            const xpForNext = level * 200;
            const currentLevelXP = totalXP % 200; // XP into current level

            return (
                <div className="mx-4 mt-4 p-5 rounded-2xl level-gradient text-white shadow-lg relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-4 opacity-10"><Icon name="Trophy" size={80}/></div>
                    <div className="relative z-10">
                        <div className="flex justify-between items-end mb-2">
                            <div>
                                <div className="text-xs font-bold uppercase opacity-80 tracking-wider">Current Rank</div>
                                <div className="text-2xl font-extrabold flex items-center gap-2">
                                    Lvl {level} <span className="text-sm font-normal opacity-90">Scholar</span>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-bold">{stats.walletBalance || 0}</div>
                                <div className="text-xs font-bold opacity-80"><Icon name="Coins" size={10}/> Coins</div>
                            </div>
                        </div>
                        <ProgressBar current={currentLevelXP} max={200} color="bg-white" />
                        <div className="flex justify-between text-[10px] mt-1 font-bold opacity-70">
                            <span>{currentLevelXP} XP</span>
                            <span>{200} XP</span>
                        </div>
                    </div>
                </div>
            );
        };

        const ShopModal = ({ userStats, onClose, onBuy, onEquip, themeColor }) => (
            <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-pop">
                <div className="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl flex flex-col max-h-[80vh]">
                    <div className="p-5 border-b flex justify-between items-center bg-gray-50">
                        <h3 className="font-bold text-lg flex items-center gap-2"><Icon name="ShoppingBag" className={`text-${themeColor}-600`}/> Theme Shop</h3>
                        <button onClick={onClose} className="p-2 bg-gray-200 rounded-full"><Icon name="X" size={14}/></button>
                    </div>
                    <div className="p-4 overflow-y-auto space-y-3">
                        <div className="bg-yellow-50 p-4 rounded-xl flex justify-between items-center border border-yellow-200">
                            <span className="font-bold text-yellow-800 text-sm">Your Wallet</span>
                            <div className="font-bold text-xl text-yellow-600 flex gap-1 items-center">{userStats.walletBalance || 0} <Icon name="Coins"/></div>
                        </div>
                        {Object.values(THEMES).map(theme => {
                            const isUnlocked = userStats.unlockedThemes?.includes(theme.id) || theme.id === 'indigo';
                            const isEquipped = userStats.currentTheme === theme.id || (!userStats.currentTheme && theme.id === 'indigo');
                            const canAfford = (userStats.walletBalance || 0) >= theme.price;

                            return (
                                <div key={theme.id} className={`flex justify-between items-center p-3 border rounded-xl ${isEquipped ? `border-${themeColor}-500 bg-${themeColor}-50` : 'border-gray-100'}`}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-10 h-10 rounded-full bg-${theme.color}-500 shadow-sm border-2 border-white`}></div>
                                        <div>
                                            <div className="font-bold text-gray-800 text-sm">{theme.label}</div>
                                            <div className="text-xs text-gray-500 font-bold">{theme.price === 0 ? "Free" : `${theme.price} Coins`}</div>
                                        </div>
                                    </div>
                                    <div>
                                        {isEquipped ? (
                                            <span className={`text-${themeColor}-600 font-bold text-xs bg-white px-2 py-1 rounded border border-${themeColor}-200`}><Icon name="Check" size={10}/> Used</span>
                                        ) : isUnlocked ? (
                                            <button onClick={()=>onEquip(theme.id)} className="bg-gray-800 text-white px-3 py-1.5 rounded-lg text-xs font-bold">Equip</button>
                                        ) : (
                                            <button onClick={()=>onBuy(theme)} disabled={!canAfford} className={`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1 ${canAfford ? 'bg-yellow-400 text-yellow-900 shadow-sm' : 'bg-gray-200 text-gray-400'}`}>
                                                {canAfford ? 'Buy' : 'Locked'} <Icon name={canAfford ? "Coins" : "Lock"} size={10}/>
                                            </button>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [activeTab, setActiveTab] = useState('routine');
            const [studyData, setStudyData] = useState({});
            const [diaryEntry, setDiaryEntry] = useState("");
            const [dailyRatings, setDailyRatings] = useState({});
            const [historyLogs, setHistoryLogs] = useState([]);
            // Stats now track XP
            const [userStats, setUserStats] = useState({ walletBalance: 0, totalXP: 0, unlockedThemes: ['indigo'], currentTheme: 'indigo' });
            
            const [installPrompt, setInstallPrompt] = useState(null);
            const [showEndDayModal, setShowEndDayModal] = useState(false);
            const [showShop, setShowShop] = useState(false);
            const [celebration, setCelebration] = useState(null); // For popup effect

            const themeKey = userStats.currentTheme || 'indigo';
            const themeColor = THEMES[themeKey].color.split('-')[1]; // 'indigo'
            const themeBg = THEMES[themeKey].bg;

            // --- INIT ---
            useEffect(() => {
                window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); setInstallPrompt(e); });
                
                // Manifest
                const link = document.createElement('link'); link.rel = 'manifest';
                link.href = URL.createObjectURL(new Blob([JSON.stringify({
                    name: "RoutinePro XP", short_name: "Routine", start_url: ".", display: "standalone",
                    background_color: "#ffffff", theme_color: "#6366f1",
                    icons: [{ src: "https://cdn-icons-png.flaticon.com/512/2921/2921222.png", sizes: "192x192", type: "image/png" }]
                })], {type: 'application/json'}));
                document.head.appendChild(link);

                if(auth) {
                    signInAnonymously(auth).catch(e => console.error(e));
                    onAuthStateChanged(auth, setUser);
                }
                const t = setInterval(() => setCurrentTime(new Date()), 60000);
                return () => clearInterval(t);
            }, []);

            // --- SYNC ---
            useEffect(() => {
                if (!user || !db) return;
                const today = new Date().toISOString().split('T')[0];
                
                // Today Listener
                const unsubToday = onSnapshot(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'dailyLogs', today), (snap) => {
                    if (snap.exists()) {
                        const d = snap.data();
                        setStudyData(d.studyData || {});
                        setDiaryEntry(d.diary || "");
                        setDailyRatings(d.ratings || {});
                    }
                });
                
                // Stats Listener
                const unsubStats = onSnapshot(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'stats', 'profile'), (snap) => {
                    if (snap.exists()) setUserStats(snap.data());
                });

                // History Listener
                const q = query(collection(db, 'artifacts', APP_ID, 'users', user.uid, 'dailyLogs'), orderBy('date', 'desc'), limit(10));
                const unsubHist = onSnapshot(q, (snap) => setHistoryLogs(snap.docs.map(d => ({id: d.id, ...d.data()}))));

                return () => { unsubToday(); unsubStats(); unsubHist(); };
            }, [user]);

            const saveData = async (updates) => {
                if(!user || !db) return;
                const today = new Date().toISOString().split('T')[0];
                await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'dailyLogs', today), {
                    date: today, ...updates, lastUpdated: serverTimestamp()
                }, { merge: true });
            };

            const getTotalStudy = () => Object.values(studyData).reduce((a, b) => a + (b.self || 0) + (b.own || 0), 0);
            
            // Calculate XP live for today (not yet saved to profile)
            const todayXP = Math.floor(getTotalStudy() * XP_PER_HOUR);

            const handleEndDay = async () => {
                if (!user || !db) return;
                
                // Award Coins & XP
                await saveData({ status: 'completed', awardedXP: todayXP });
                await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'stats', 'profile'), {
                    walletBalance: increment(todayXP),
                    totalXP: increment(todayXP)
                }, { merge: true });

                // Show Celebration
                setCelebration(todayXP);
                setShowEndDayModal(false);
                setTimeout(() => setCelebration(null), 3000);
            };

            const handleBuy = async (theme) => {
                if(userStats.walletBalance >= theme.price) {
                    await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'stats', 'profile'), {
                        walletBalance: increment(-theme.price),
                        unlockedThemes: [...(userStats.unlockedThemes||[]), theme.id]
                    }, { merge: true });
                }
            };

            const handleEquip = async (id) => {
                await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'stats', 'profile'), { currentTheme: id }, { merge: true });
            };

            // --- RENDERERS ---
            const renderRoutine = () => (
                <div className="space-y-3 pb-24 animate-slide-up px-4">
                    <div className="flex justify-between items-center mb-2 mt-4">
                        <h2 className={`text-lg font-bold text-${themeColor}-900`}>Today's Routine</h2>
                        <span className="text-xs bg-white border px-2 py-1 rounded text-gray-500 font-mono">{new Date().toLocaleDateString('en-US', {weekday:'short'})}</span>
                    </div>
                    {DEFAULT_ROUTINE.map((item, i) => {
                         const [h,m] = item.time.split(':');
                         const itemTime = new Date(); itemTime.setHours(h,m,0);
                         const diff = (currentTime - itemTime) / 60000;
                         const isActive = diff >= 0 && diff < 60;
                         const isDone = dailyRatings[item.time] > 0;
                         
                         return (
                            <div key={i} className={`flex items-center gap-3 p-3 rounded-xl border transition-all ${isActive ? `bg-${themeColor}-50 border-${themeColor}-500 shadow-md transform scale-[1.02]` : isDone ? 'bg-gray-50 opacity-60' : 'bg-white border-gray-100'}`}>
                                <div className={`font-mono text-xs font-bold w-10 ${isActive ? `text-${themeColor}-600` : 'text-gray-400'}`}>{item.time}</div>
                                <div className="flex-1 font-medium text-sm text-gray-700">{item.label}</div>
                                <div className="flex gap-1">
                                    {[1,2,3,4,5].map(star => (
                                        <button key={star} onClick={()=>{
                                            const newR = {...dailyRatings, [item.time]: star};
                                            setDailyRatings(newR); saveData({ratings: newR});
                                        }} className={`${star <= (dailyRatings[item.time]||0) ? 'text-yellow-400' : 'text-gray-200'} text-lg`}>â˜…</button>
                                    ))}
                                </div>
                            </div>
                         )
                    })}
                </div>
            );

            const renderStudy = () => (
                <div className="space-y-4 pb-24 animate-slide-up px-4">
                    <div className={`mt-4 bg-white p-4 rounded-2xl border border-${themeColor}-100 shadow-sm flex items-center justify-between`}>
                        <div>
                            <div className="text-gray-400 text-xs font-bold uppercase tracking-wider">Session XP</div>
                            <div className="text-3xl font-extrabold text-gray-800">+{todayXP} <span className="text-sm font-normal text-gray-400">XP</span></div>
                        </div>
                        <div className={`h-12 w-12 rounded-full bg-${themeColor}-100 text-${themeColor}-600 flex items-center justify-center`}>
                            <Icon name="Fire" size={24}/>
                        </div>
                    </div>
                    
                    <div className="grid gap-3">
                        {SUBJECTS.map(sub => (
                            <div key={sub} className="bg-white p-3 rounded-xl border border-gray-100 flex flex-col gap-2 shadow-sm">
                                <div className="flex justify-between items-center border-b border-gray-50 pb-2">
                                    <span className="font-bold text-gray-700 text-sm flex items-center gap-2">
                                        <span className={`w-2 h-2 rounded-full bg-${themeColor}-500`}></span> {sub}
                                    </span>
                                    <span className="text-xs font-bold text-gray-400">
                                        {(parseFloat(studyData[sub]?.self||0) + parseFloat(studyData[sub]?.own||0))}h
                                    </span>
                                </div>
                                <div className="flex gap-3">
                                    <div className="flex-1">
                                        <label className="text-[10px] text-gray-400 font-bold">SELF (HRS)</label>
                                        <input type="number" step="0.5" className="w-full bg-gray-50 border rounded-lg p-2 text-center font-bold text-gray-700 focus:ring-2 focus:ring-indigo-500 outline-none"
                                            value={studyData[sub]?.self || ''}
                                            onChange={e => {
                                                const newVal = {...studyData, [sub]: {...studyData[sub], self: parseFloat(e.target.value)||0}};
                                                setStudyData(newVal); saveData({studyData: newVal});
                                            }}/>
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-[10px] text-gray-400 font-bold">COACH (HRS)</label>
                                        <input type="number" step="0.5" className="w-full bg-gray-50 border rounded-lg p-2 text-center font-bold text-gray-700 focus:ring-2 focus:ring-indigo-500 outline-none"
                                            value={studyData[sub]?.own || ''}
                                            onChange={e => {
                                                const newVal = {...studyData, [sub]: {...studyData[sub], own: parseFloat(e.target.value)||0}};
                                                setStudyData(newVal); saveData({studyData: newVal});
                                            }}/>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className={`min-h-screen ${themeBg} pb-safe relative overflow-hidden`}>
                    {/* Celebration Overlay */}
                    {celebration && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-pop" onClick={() => setCelebration(null)}>
                            <div className="text-center">
                                <Icon name="Trophy" size={80} className="text-yellow-400 mb-4 animate-bounce"/>
                                <h2 className="text-3xl font-bold text-white mb-2">Day Complete!</h2>
                                <p className="text-white/80 text-lg">You earned</p>
                                <div className="text-5xl font-extrabold text-yellow-400 my-4">+{celebration} XP</div>
                                <p className="text-white/60 text-sm">Added to wallet</p>
                            </div>
                        </div>
                    )}

                    {/* Header */}
                    <div className="bg-white/90 backdrop-blur sticky top-0 z-30 px-4 py-3 border-b border-gray-100 flex justify-between items-center shadow-sm">
                        <div className={`font-bold text-lg text-${themeColor}-700 flex items-center gap-2`}><Icon name="Layout"/> RoutinePro</div>
                        <div className="flex gap-2">
                            <button onClick={()=>setShowShop(true)} className={`flex items-center gap-1.5 bg-${themeColor}-50 text-${themeColor}-700 px-3 py-1.5 rounded-full text-xs font-bold border border-${themeColor}-100 shadow-sm active:scale-95 transition-transform`}>
                                <Icon name="ShoppingBag" size={12}/> {userStats.walletBalance || 0}
                            </button>
                        </div>
                    </div>

                    {/* Gamification Stats Card */}
                    <GamificationCard stats={userStats} todayXP={todayXP} />

                    {/* Tabs Content */}
                    <div className="max-w-md mx-auto">
                        {activeTab === 'routine' && renderRoutine()}
                        {activeTab === 'study' && renderStudy()}
                        {activeTab === 'diary' && (
                            <div className="p-4 h-[70vh] flex flex-col animate-slide-up">
                                <textarea className="flex-1 w-full bg-white rounded-2xl p-5 border border-gray-200 resize-none text-lg leading-relaxed shadow-sm outline-none focus:ring-2 focus:ring-indigo-500"
                                    placeholder="Write about your day..." value={diaryEntry}
                                    onChange={e => { setDiaryEntry(e.target.value); saveData({diary: e.target.value}); }}
                                ></textarea>
                                <div className="text-right text-xs text-gray-400 mt-2 flex items-center justify-end gap-1"><Icon name="Save" size={12}/> Saving...</div>
                            </div>
                        )}
                        {activeTab === 'history' && (
                            <div className="p-4 space-y-3 pb-24 animate-slide-up">
                                <h2 className="font-bold text-lg text-gray-800">Past Days</h2>
                                {historyLogs.length === 0 ? <div className="text-center text-gray-400 py-10">No history yet</div> : historyLogs.map(log => (
                                    <div key={log.id} className="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex justify-between items-center">
                                        <div>
                                            <div className="font-bold text-gray-800">{new Date(log.date).toLocaleDateString(undefined, {month:'short', day:'numeric'})}</div>
                                            <div className="text-xs text-gray-500 truncate max-w-[150px]">{log.diary || "No notes"}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="font-bold text-indigo-600 text-sm">{Object.values(log.studyData||{}).reduce((a,b)=>a+(b.self||0)+(b.own||0),0)}h</div>
                                            {log.awardedXP && <div className="text-[10px] text-yellow-500 font-bold">+{log.awardedXP} XP</div>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Finish Day FAB */}
                    {(activeTab === 'routine' || activeTab === 'study') && (
                        <button onClick={()=>setShowEndDayModal(true)} className="fixed bottom-24 right-5 bg-gray-900 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center z-40 active:scale-90 transition-transform border-4 border-white">
                            <Icon name="Check" size={20}/>
                        </button>
                    )}

                    {/* Bottom Navigation */}
                    <div className="fixed bottom-0 w-full bg-white/95 backdrop-blur border-t border-gray-200 pb-safe z-30">
                        <div className="flex justify-around p-2 max-w-md mx-auto">
                            {['routine', 'study', 'diary', 'history'].map(t => (
                                <button key={t} onClick={()=>setActiveTab(t)} className={`flex flex-col items-center justify-center w-16 h-14 rounded-xl transition-all ${activeTab===t ? `text-${themeColor}-600 bg-${themeColor}-50` : 'text-gray-400 hover:bg-gray-50'}`}>
                                    <Icon name={t === 'routine' ? 'List' : t === 'study' ? 'BookOpen' : t === 'diary' ? 'Edit3' : 'History'} size={18}/>
                                    <span className="text-[9px] font-bold uppercase mt-1">{t}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* End Day Modal */}
                    {showEndDayModal && (
                        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-pop">
                            <div className="bg-white rounded-3xl w-full max-w-sm p-6 space-y-5 shadow-2xl">
                                <div className="text-center">
                                    <div className="w-16 h-16 bg-yellow-100 text-yellow-500 rounded-full flex items-center justify-center mx-auto mb-3"><Icon name="Trophy" size={30}/></div>
                                    <h3 className="font-bold text-xl text-gray-900">Finish Today?</h3>
                                    <p className="text-gray-500 text-sm mt-1">You will earn coins based on your study.</p>
                                </div>
                                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100 flex justify-between items-center">
                                    <span className="text-sm font-bold text-gray-600">Total Study</span>
                                    <span className="text-lg font-bold text-gray-900">{getTotalStudy().toFixed(1)} hrs</span>
                                </div>
                                <div className="bg-yellow-50 p-4 rounded-xl border border-yellow-100 flex justify-between items-center">
                                    <span className="text-sm font-bold text-yellow-800">Reward</span>
                                    <span className="text-lg font-bold text-yellow-600">+{todayXP} Coins</span>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={()=>setShowEndDayModal(false)} className="flex-1 py-3 rounded-xl font-bold text-gray-500 hover:bg-gray-100">Cancel</button>
                                    <button onClick={handleEndDay} className={`flex-1 py-3 rounded-xl font-bold text-white bg-${themeColor}-600 shadow-lg shadow-${themeColor}-200`}>Claim</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showShop && <ShopModal userStats={userStats} onClose={()=>setShowShop(false)} onBuy={handleBuy} onEquip={handleEquip} themeColor={themeColor}/>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


